-----------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/xiongyiliang/Workspace/Stata/sprobit/sprobit_ml.log
  log type:  text
 opened on:   9 Aug 2011, 14:25:08

. 
. // read data
. clear

. cd ~/Workspace/Stata/sprobit
/Users/xiongyiliang/Workspace/Stata/sprobit/

. use merged_actv_pers

. sort sampno persno

. 
. // global varibles
. qui tab actcode

. global M = r(r)

. qui tab relate

. global N = r(r)

. global NM = $N*$M

. disp $NM
8

. matrix Wk = (0.0, 0.5 \ 0.5, 0.0)

. matrix W  = Wk # I($M)

. /*
>         TODO define economic distance matrix
> */
. global hid sampno

. global y choice

. global X age i.gender i.employ i.student

. /*
>         TODO extend to alternative specified parameters
> */
. 
. mdraws, dr(10) neq($NM) prefix(z) burn(10) antithetics
Created 10 Halton draws per equation for 8 dimensions. Number of initial draws dropped per dimension = 10 .
Primes used:

   2   3   5   7  11  13  17  19
Also created 10 antithetic draws per dimension for 8 dimensions.  Note: there are now 20 draws per equation

. global dr = r(n_draws)

. 
. // get initial value from probit
. probit $y $X

Iteration 0:   log likelihood = -3660.1725  
Iteration 1:   log likelihood = -3635.6259  
Iteration 2:   log likelihood =  -3635.624  
Iteration 3:   log likelihood =  -3635.624  

Probit regression                                 Number of obs   =       5576
                                                  LR chi2(4)      =      49.10
                                                  Prob > chi2     =     0.0000
Log likelihood =  -3635.624                       Pseudo R2       =     0.0067

------------------------------------------------------------------------------
      choice |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         age |  -.0062487   .0013436    -4.65   0.000    -.0088821   -.0036152
    2.gender |   .1225165   .0357139     3.43   0.001     .0525186    .1925144
    2.employ |   .1647148   .0416896     3.95   0.000     .0830046     .246425
   2.student |   .1123902   .0750803     1.50   0.134    -.0347644    .2595448
       _cons |  -.2706088   .0928204    -2.92   0.004    -.4525335   -.0886842
------------------------------------------------------------------------------

. matrix b0 = e(b)

. 
. // call simulation-based ML
. ml model d0 sprobit_d0 (choice: $y = $X) /r, tech(nr) ///
> title(Spatial Probit Model, $dr Random Draws)

. ml init b0

. ml maximize, difficult

initial:       log likelihood = -3635.6241
rescale:       log likelihood = -3635.6241
rescale eq:    log likelihood = -3635.6241
Iteration 0:   log likelihood = -3635.6241  
Iteration 1:   log likelihood = -3231.3409  (not concave)
Iteration 2:   log likelihood = -3230.2423  (not concave)
Iteration 3:   log likelihood = -3230.1052  (not concave)
Iteration 4:   log likelihood = -3230.0953  (not concave)
Iteration 5:   log likelihood = -3230.0909  (not concave)
Iteration 6:   log likelihood = -3229.7249  (not concave)
Iteration 7:   log likelihood =  -3229.708  (not concave)
Iteration 8:   log likelihood =  -3229.675  (not concave)
Iteration 9:   log likelihood = -3229.6158  (not concave)
Iteration 10:  log likelihood = -3228.9719  (not concave)
Iteration 11:  log likelihood = -3228.8888  (not concave)
Iteration 12:  log likelihood = -3228.8645  (not concave)
Iteration 13:  log likelihood = -3228.8267  (not concave)
Iteration 14:  log likelihood =  -3228.784  (not concave)
Iteration 15:  log likelihood =  -3228.773  (not concave)
Iteration 16:  log likelihood = -3228.7464  (not concave)
Iteration 17:  log likelihood = -3228.7185  (not concave)
Iteration 18:  log likelihood = -3228.7015  
Iteration 19:  log likelihood = -3228.6986  (not concave)
Iteration 20:  log likelihood = -3228.6896  
Iteration 21:  log likelihood = -3228.6695  (not concave)
Iteration 22:  log likelihood = -3228.6579  
Iteration 23:  log likelihood = -3228.6578  
Iteration 24:  log likelihood = -3228.6549  
Iteration 25:  log likelihood = -3228.6549  
Iteration 26:  log likelihood = -3228.6539  
Iteration 27:  log likelihood = -3228.6538  

Spatial Probit Model, 20 Random Draws             Number of obs   =       5576
                                                  Wald chi2(4)    =      68.21
Log likelihood = -3228.6538                       Prob > chi2     =     0.0000

------------------------------------------------------------------------------
      choice |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
choice       |
         age |  -.0057144   .0013189    -4.33   0.000    -.0082994   -.0031294
    2.gender |   .2837905    .047385     5.99   0.000     .1909177    .3766633
    2.employ |   .1685709    .044315     3.80   0.000      .081715    .2554268
   2.student |    .105001   .0780094     1.35   0.178    -.0478947    .2578966
       _cons |  -.2863516   .0873173    -3.28   0.001    -.4574903   -.1152129
-------------+----------------------------------------------------------------
r            |
       _cons |   .8916536   .0292242    30.51   0.000     .8343751    .9489321
------------------------------------------------------------------------------

. 
. // turn off log
. log off
      name:  <unnamed>
       log:  /Users/xiongyiliang/Workspace/Stata/sprobit/sprobit_ml.log
  log type:  text
 paused on:   9 Aug 2011, 15:13:29
-----------------------------------------------------------------------------------------------------------------
